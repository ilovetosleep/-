# 研究背景、意义及现状
压力性尿失禁(Stress Urinary Incontinence, SUI)[1-3]是指在体力活动、咳嗽、打喷嚏等行动时,由于腹压增加,使得膀胱内压力超过了尿道括约肌的封闭压力,导致尿液非自主地漏出来,而不是在适当的时间和地点进行排尿的症状。全球大约有2亿人受到其困扰，尤其是随着年龄的增长，其患病率和严重程度逐渐增加[4]。SUI患者经常因长期不自主漏尿以及由此引起的身体异味感到社会活动受限，严重影响其生活质量。
SUI的诊疗通常分为主观评价和客观检查。SUI的严重程度主观评价采用Ingelman-Sundberg分度法进行分度，分为轻度、中度和重度三种[5]。轻度尿失禁指咳嗽或打喷嚏时会有尿液泄漏，但不需要使用尿垫。中度尿失禁在日常活动中，如跑步、跳跃或快步行走时会发生，需要使用尿垫。重度尿失禁则是在轻微的身体活动或平卧体位改变时就会发生尿液泄漏。而客观检查通常是采用1h尿垫试验，该试验要求在试验开始前，患者需要保持膀胱充盈，持续1h，并在试验开始后不再排尿。在预先放置经过称重的尿垫（例如卫生巾）之后，试验开始的前15min内，患者需要饮用500mL的白开水；接下来的30min内，患者需要走路，上下1层楼的楼梯。最后15min内，患者需要坐立10次，用力咳嗽10次，原地跑步1min，拾起地面物品5次，并用自来水洗手1min。试验结束时，需要称重尿垫，并要求患者排尿并测量尿量。漏尿量≥2g为阳性。轻度：2g≤漏尿量<5g；中度：5g≤漏尿量<10g；重度：10g≤漏尿量<50g；极重度：漏尿量≥50g[5]。因此尿失禁漏尿量检测对SUI患者的患病程度的判断有着重要意义。
目前，不管是主观评价还是客观检查，SUI发生时都无法做到实时判断，且均需要在医院环境下开展，这些方法不仅成本高，不能充分反映SUI患者日常生活中面临的各种诱发因素，而且不便于长期监测。因此，研究一种简便、低成本且高效的尿失禁监测方法具有重要意义。而智能可穿戴设备作为健康监测领域的新兴技术，提供了一种新的解决方案。但从国内外的研究现状来看，尿失禁监测技术依然存在无法多次使用、实时性无法保证、无法准确监控病人漏尿严重程度、需要侵入式采集手段等问题，这些问题也导致了这些设备还处于实验阶段难以产品化，或者功能欠缺导致应用场合比较局限等[6]。总体来说，用于日常使用的SUI 的检测技术还相对较少。
## 参考文献：
[1]李志毅, 朱兰. 女性压力性尿失禁流行病学现状[J]. 实用妇产科杂志, 2018, 34(3): 2. 
[2]Ortiz O, Contreras O. Stress urinary incontinence in the gynecological practice[J]. International Journal of Gynecology & Obstetrics, 2004, 86: S6-S16.
[3]Luber KM. The definition, prevalence, and risk factors for stress urinary incontinence[J]. Reviews in urology, 2004, 6(Suppl 3): S3.
[4]邰红妍, 何桂香, 李艳群, 等. 长沙市养老机构老年人尿失禁的流行现况及影响因素[J]. 中华疾病控制杂志, 2022, 26(4): 412-416.  
[5]中华医学会妇产科学分会妇科盆底学组. 女性压力性尿失禁诊断和治疗指南（2017）[J]. 中华妇产科杂志, 2017, 52(5): 289-293. 
[6]邹贤文. 可穿戴的尿失禁监测系统研究[D]. 电子科技大学, 2023.

# 需求分析
## 功能需求（分条目列出）
（1）实时监测漏尿频次：系统需要能够实时监测并记录尿失禁患者的漏尿频次，包括漏尿的具体时间点以及漏尿事件的间隔时间。
（2）数据存储与传输：系统需要具备数据存储功能，能够将监测到的数据保存在本地存储设备中，并支持数据通过无线方式传输到外部设备（如智能手机或电脑）进行进一步的分析和处理。
（3）用户界面：系统应配备直观易用的用户界面，方便用户查看漏尿事件记录及其他相关数据。
（4）能耗管理：系统应设计有效的能耗管理策略，确保传感器和数据传输装置在尽可能低的能耗下运行，延长使用周期。

## 定量技术指标（分条目列出，写上必要理论计算过程）
（1）漏尿识别：漏尿监测误报率不应超过5%。
漏尿监测系统的准确性直接影响用户体验和系统可靠性。误报率过高会导致用户不信任系统，而漏报则会漏掉重要的健康信息。选择5%的误报率标准是为了平衡这两方面的需求，同时考虑到技术实现的难度和成本。
（2）传感器尺寸与重量：传感器的厚度应不超过2毫米，重量不超过20克，以最小化对用户的影响。
传感器的尺寸和重量直接影响穿戴舒适度。2毫米的厚度和20克的重量限制旨在确保传感器对日常活动的干扰最小化。
（3）电池续航：在正常使用条件下，电池续航不少于48小时，以减少充电或更换电池的频率。
长电池续航对于用户来说意味着更低的维护需求，增加了使用便利性。48小时的电池续航考虑到了日常使用需求，避免频繁充电或更换电池。
通过估算系统的平均功耗，结合电池容量，计算电池续航时间。T=C/I，其中T是电池寿命（h），C是电池容量（mAh），I是平均电流消耗（mA）。
（4）防水等级：考虑到使用环境，传感器及相关电子设备需满足至少IP67的防水防尘等级。
IP67等级能确保设备在短时间内完全浸入水中也不会损坏，这对于漏尿监测设备来说是必要的，因为它需要能够抵抗尿液和其他液体的侵蚀。
（5）工作温度范围：系统应能在10℃至50℃的温度范围内稳定工作，以适应不同环境条件。
设计考虑到设备可能会在各种环境中的人体皮肤表面温度下使用，从冷到热的温度范围保证了设备的适应性和稳定性。
（6）功耗：传感器系统的平均功耗应不超过500毫瓦（mW），以延长电池寿命并减少充电频率。
在设计过程中，需要优化电路设计和算法实现，以尽可能降低功耗，并确保满足设定的功耗限制。通过确保系统的平均功耗不超过500毫瓦，可以在不牺牲设备性能和稳定性的前提下，延长电池寿命，减少用户的充电频率，提升使用体验。

## 设计约束（硬件、软件、时间成本、经济成本等）
（1）硬件和软件设计约束
硬件设计约束：
传感器选择：需要选择适合的柔性传感器，具有高灵敏度、稳定性和耐用性，同时要考虑成本和可制备性。
主控芯片：STM32F103C8T6主控芯片需满足系统运行的计算和控制需求，同时考虑功耗、成本和性能。
蓝牙模块：蓝牙模块需要兼容上位机，并具有稳定的信号传输和低功耗特性。
软件设计约束：
实时性要求：软件需具有高实时性，能够及时响应传感器数据的变化，并将数据传输至上位机。
稳定性：软件设计需保证系统稳定运行，防止出现死机、崩溃等异常情况。
可扩展性：软件应具有良好的可扩展性，方便后续功能的添加和修改。
（2）时间和经济成本
时间成本：
研发周期：需要考虑研发周期，包括硬件设计、软件开发、测试和优化等阶段，以确保项目按时完成。
目标用户反应时间：需考虑目标用户的接受时间，新产品出现未必能立刻得到认可。
经济成本：
硬件成本：包括传感器、主控芯片、蓝牙模块等硬件设备的研发和采购成本。
软件开发成本：包括人力成本、软件工具等开发软件的成本。
生产成本：包括生产设备、人工费用等生产过程中的成本。
市场推广成本：包括市场调研、广告宣传等推广产品的费用。
维护成本：包括售后服务、软件更新等维护产品的费用

# 方案设计
## 总体方案设计及技术路线（文字结合框图共同描述）
（1）总体方案设计
本文系统由实时监测、数据上传、终端显示和数据存储等四大功能模块组成。
硬件方面四大功能模块是通过STM32F103C8T6主控芯片和自制传感器开发来实现的。系统包括漏尿传感器、最小系统板、手机端上位机、电脑端上位机。该系统的远程通信是通过蓝牙实现的，传感器感知患者漏尿程度，并通过蓝牙将实时监测的信息发送到上位机，实现远程控制。系统总体方案如图1所示。


图1 总体方案

软件方面，使用μc/OS-III操作系统进行综合系统设计，分为主函数、根任务和三个子任务，其中主函数负责初始化、创建根任务和启动多任务环境等工作，根任务负责初始化、创建多个子任务和删除自身等工作，三个子任务分别是数据采集、数据处理和数据传输。各部分的控制流图与详细工作情况如下。 
（2）技术路线 
第一步是进行硬件设计，包括选择传感器和模拟前端芯片，以及设计电源电路，并验证电路可行性。 
第二步是进行软件设计，选择μc/OS-III操作系统作为 RTOS。 
第三步是编写对应滤波、计算算法，实现信号的准确采集和处理。 
第四步是设计用户界面，利用串口屏显示实时数据和菜单设置。
2.硬件设计（最小系统、功能模块等，结合需求分析说明各器件选型及其依据）
（1）STM32F103C8T6 最小系统
为了协调本系统的各个模块正常工作，整理和发送收集的数据，因此需要设计主控单元来协调各个模块。通常来说微控制器（Microcontroller Unit, MCU）是整个前端模块的核心，市面上流行着许多小尺寸、低功耗的嵌入式微处理器，例如飞思卡尔的KinetisL系列等，但是如果以这些系列的芯片作为主控芯片的话，前端模块的处理板卡上还需要搭载外加的ADC模块，这就会增加整个板卡的尺寸。为了减小板卡尺寸提升用户体验，本文的主控芯片选择集成了ADC功能的处理芯片STM32F103C8T6。
STM32F103C8T6拥有更丰富的硬件资源，在后期产品的功能拓展方面实现更加方便。最高72MHz工作频率，内嵌经出厂调教的8MHz的RC振荡器，拥有串行单线调试（SWD)和JTAG接口，多达8个定时器，3个16位定时器，2个看门狗定时器2个I2C接口，3个USART接口2个SPI接口。
为了使芯片正常工作，需要设计其最小系统，主要由晶振电路，供电电路等组成，其原理图如图2所示。
（2）传感尿片结构设计
当SUI患者失禁后，尿液会改变尿片的湿度，根据此特性，使用湿度传感器测量尿片湿度改变即可得出患者是否失禁这一信息。本传感器利用刺绣技术，使用镀银铜线在尿片上纺织叉指型图案构成湿度传感器。在使用过程中可以将该结构整体看成一个电阻，在湿度增大或者减小时传感器的电阻值会相应的增大或减小，如图3所示。


图2 STM32F103C8T6 最小系统原理图


图3 叉指型湿度传感器结构

图4 湿度传感器外围电路

要测量湿度传感器的电阻值，本文使用图4所示的通常使用一个阻值已知，大小为R3的下拉电阻与湿度传感器串联分压，再施加固定的直流电压VCC，此处为3.3V。然后使用单片机自带的ADC采集传感器两端的电压Vout，可以使用下式计算湿度传感器电阻值：

使用该原理测量湿度时，如果下拉电阻R3的阻值选择过大或者过小，则采集到的湿度传感器两端的电压Vout范围会很小，因ADC采样时受精度限制会有误差，在小范围采样时误差影响会被放大，严重影响结果，因此选择一个合适的R3阻值可增大采样范围，减小计算结果的误差，经过比对本系统R3采用10k电阻。
由于本系统需要监测SUI病人一天内的失禁状况，因此需要传感器在一天内能多次使用，故本系统传感器结构中需要设计吸水层，一般病人每次漏尿量的范围从几滴到几毫升不等，因此采取吸水倍率能达到20倍左右的5g吸水材料即可，本系统中采用的是高分子吸水树脂来作为吸水层。为了防止吸收芯吸收的尿液打湿病人内裤，因此需要采用聚乙烯材料的底层来隔绝尿液和内裤。为了保证整个吸收芯能均匀吸收漏出的尿液，提高吸收材料利用率，加快尿液渗入吸收层，需要设置导流层来将尿液导向整个吸收芯平面，同时，导流层还可防止尿液从吸水材料中反渗回上层之中，如图5所示。

图5 传感器尿片结构图

实物外观与市面上常规使用的尿片基本无差别，本文所设计的带有传感器的尿片实物如图6所示。

图6 本文所设计的尿片实物图

（3）蓝牙主控单元
本嵌入式系统选择doBT-M02蓝牙模块作为从机，将实时监测的信息发送到蓝牙主机。doBT-M02是一款支持蓝牙双模的纯数据蓝牙模块，超小尺寸，尽可能减小穿戴时的异物感；价格低廉，在减小成本的同时可以满足数据传输、实时监控、设备连接、便携性等要求。不仅提高了数据传输的效率和可靠性，还增强了用户体验，提升了系统的实用性和智能化水平。

图7 doBT-M02蓝牙模块原理图


图8 doBT-M02蓝牙模块实物图

（4）电源管理模块
在无线传输的嵌入式电路设计中电源和开关控制至关重要，因此在选择了多个模块的芯片后首先需要考虑的就是电源管理和开关控制的设计。本系统的前端模块采用3.7V的锂电池供电，根据各个芯片的需求，供电电压的要求3.3V。在电源电路设计时，需要考虑几个稳压芯片核心参数：最大驱动电流、压差、精度以及电源纹波抑制比。最大驱动电流是后续元器件是否能正常工作的关键参数，压差决定了芯片正常工作的电压范围，电源纹波抑制比对于某些精度要求比较高的器件（如运放或者ADC）比较重要。
在芯片选择前，需要计算系统功耗，选择驱动能力合适的芯片。查阅相关资料决定充放电管理模块采用TP4056，这是一款完整的单节钮离子电池采用恒定电流/恒定电压线性充电器。其底部带有散热片的ESOP8封装与较少的外部元件数目使得TP4056成为便携式应用的理想选择。TP4056可以适合USB电源和适配器电源工作。由于采用了内部PMOSFET架构，加上防倒充电路，所以不需要外部隔离二极管。热反馈可对充电电流进行自动调节，以便在大功率操作或高环境温度条件下对芯片温度加以限制。充满电压4.2V而充电电流可通过一个电阻器进行外部设置。

图9 电源管理部分原理图
当充电电流在达到最终浮充电压之后降至设定值1/10时，TP4056将自动终止充电循环。当输入电压(交流适配器或USB电源)被拿掉时，TP4056自动进入一个低电流状态，将电池漏电流隆至3uA以下。电源管理部分原理图如图9所示。
本文设计时放置了2颗与充电状态有关的LED灯，如图10所示，充电时上方的红色LED常亮，充满电时下方的红色LED常亮。


图10 充电状态指示灯

（5）PCB设计
在PCB布局上需要注意的是蓝牙模块的射频天线部分需要靠近板边，且天线周围不能铺铜、不能走线，否则会影响信号质量。

 
图11 系统PCB设计（左侧为正面，右侧为背面）

其次，电源的走线尽量短而粗；信号线之间尽可能相互平行，为避免导线之间串扰，尽量遵循3W原则，走线角度尽量为钝角；地线的走线尽量通过铺铜将数字地和模拟地分开，最后使用磁珠或者0Ω电阻连接二者。基于以上规则和注意事项，PCB布局如图11所示。实物电路板如图12所示。

 
图12 系统电路板实物图

3. 软件设计（对关键传感器等功能器件，采用的核心通信、控制、计算等的实现算法，利用流程图、时序图、文字等联合描述）
在已有的硬件基础上，还需要进行软件开发，而本章主要研究内容为前端模块的嵌入式程序设计和上位机程序设计。前端模块嵌入式程序主要任务是驱动外设，蓝牙通信和同步数据，此外，在完成基本功能的情况下尽可能智能化、低功耗。上位机程序主要任务是设计GUI、实时处理数据、计算结果并显示和存储起来。
主函数的控制流程图如下：


	(a)主函数	(b)根任务
图13 主函数和根任务的控制流程图


各子任务的控制流程如下：


	(a) task1	(b)task2	(c)task3
图14 各任务的控制流程图

1. 实时监测漏尿频次
漏尿监测系统采用ADC（模数转换器）读取传感器数据，ADC用于检测漏尿传感器的电压变化，这些变化反映漏尿情况，并通过UART进行数据传输。系统使用UART进行数据传输，通过串口发送传感器数据到外部设备（如智能手机或电脑）。

2. PC端上位机软件
本系统需要在PC上实现对采集到的数据进行存储、处理、分析和可视化，上位机主要涉及到的功能包括串口通信、数据的解码和处理、数据存储和实时显示等功能。开发过程中使用了LabView做为处理数据存储数据的高级语言， LabVIEW是一种由National Instruments（NI）开发的图形化编程环境和开发系统。它主要用于数据采集、仪器控制、工业自动化、信号处理等领域。与传统的文本编程语言不同，LabVIEW使用图形化编程语言称为G语言（G Programming Language）。用户通过在屏幕上拖放图标（称为虚拟仪器或VI，Virtual Instrument）并连接它们来构建程序，帮助用户快速搭建复杂的测量和控制系统。大大减小了开发难度，使用的LabVIEW版本为2016，实现GUI可视化界面，并使用了visa库来实现串口通信。
本系统上位机采用多线程设计，主线程实现界面交互以及波形和数据的实时显示功能；子线程实现串口通信接收数据，数据解包，发送确认信号给从机。
如图15所示，界面左侧是显示实时数据和波形以及统计当日失禁情况的区域，右侧为按键功能区。按键区主要能实现串口连接，控制数据采集的开启与关闭等功能；显示区主要显示实时数据和波形等；下侧两个指示灯提示患者失禁级别。

图15 PC端上位机交互界面

3.手机端上位机：
手机端上位机通过蓝牙调试器开发，该调试器基于安卓设备，通过安卓设备的蓝牙通信功能实现单片机的无线调试，支持的功能有普通的串口收发显示、类似普通蓝牙调试器的按钮收发、支持自定义功能的界面开发，界面支持摇杆，按钮，开关等常见的设备、支持对话框等页面。
通过设置发送或者接收数据的类型和数量就可以在编辑器件中链接变量。
该软件有一个简单的协议，数据包主要包括四部分：包头、原数据、校验和包尾，其中包头一定要是0XA5，包尾一定要是0X5A。
如图16所示，界面上侧是显示实时数据和波形以及统计当日失禁情况的区域，下侧为按键功能区，按键区控制数据采集的开启与关闭等功能；显示区主要显示实时数据和波形等，当轻触显示屏可在右侧面板选择测量波形范围、保存数据；用户可在触屏上用手指放大缩波形图以方便观测；下侧两个指示灯提示患者失禁级别。

图16 手机端上位机交互界面
4.能耗管理
在µC/OS-III中通过任务挂起和信号量机制来降低系统能耗。在系统启动时，默认关闭信号量，并将其置为0。此时，系统处于低功耗待命状态，等待蓝牙主机的指令。当蓝牙主机发送开启指令时，系统接收到该指令并将对应的信号量置为1，表示数据采集任务可以执行。这一行动将系统从低功耗待命状态唤醒。一旦信号量被置为1，数据采集任务开始执行。它负责采集传感器数据，并将采集完的数据放入消息列表中。另一个任务负责从消息列表中提取数据，并通过蓝牙发送出去。这一步骤保证了采集到的数据能够及时传输到外部设备。当数据采集任务完成其工作后，信号量会被重置为0，表示系统可以再次进入低功耗待命状态，等待下一次蓝牙指令的到来。
通过以上流程，系统能够有效地管理能耗，在需要采集数据时才启动相应的任务，节省了不必要的能耗。同时，延长了电池寿命，提高了系统的可靠性和稳定性。
流程图如图17所示：

图17 能耗管理控制流程图
四、结果与测试
1. 功能测试（说明测试方法、步骤及结果）
（1）实时监测漏尿情况
系统需要能够实时监测并记录尿失禁患者的漏尿情况，包括漏尿的具体时间点以及漏尿事件的间隔时间。
本文使用PH为6.0左右的的人工模拟尿液（PH1879）来替代SUI病人尿液，所有实验均在室温条件下进行。





图18 实验设备连接图

尿量和尿频次检测需要先将60mL的针管固定，然后固定传感尿片，再将传感尿片连接到前端模块采样端，最后把数据传输到上位机。实验设备连接如图18所示。
在控制环境下，模拟多次漏尿情景，记录每次漏尿的具体时间点和事件间隔。比较设备记录的数据和实际漏尿时间点，确保设备能实时准确地监测漏尿的发生。

（2）数据存储与传输
系统需要具备数据存储功能，能够将监测到的数据保存在本地存储设备中，并支持数据通过无线方式传输到外部设备（如智能手机或电脑）进行进一步的分析和处理。
模拟一段时间内的漏尿数据，确保设备能够将这些数据正确存储在本地存储设备中。检查存储的数据完整性和准确性，确保无数据丢失或错误。传输过程中，监测数据的传输速度和稳定性，确保数据无误传输到外部设备。
漏尿数据如下图19和图20所示：


图19 漏尿数据显示页面(PC端)


图20 漏尿数据显示页面(手机端)

（3）用户界面
系统应配备直观易用的用户界面，方便用户查看漏尿事件记录及其他相关数据。
分别设置三组技术水平不同的用户使用系统，并观察他们在浏览漏尿事件记录及其他相关数据时的行为和反应。使用SUS（System Usability Scale）分别对PC端和手机端用户界面的易用性进行量化评估，其分级范围如表1所示。当参与者做完一系列任务后，就可以快速对SUS进行打分。然后就需要对每个题目的分值进行转换，奇数项计分采用“原始得分-1”，偶数项计分采用“5-原始得分”。由于是5点量表，每个题目的得分范围记为0~4（最大值为40），而SUS的范围在0~100，故需要把所有项的转换分相加，最终再乘以2.5，即可获得SUS分数。图20为SUS分数曲线分级范围。

表1 SUS分数曲线分级范围
SUS分数等级	评级	百分等级(%)
84.1-100	A+	96-100
80.8-84	A	90-95
78.9-80.7	A-	85-89
77.2-78.8	B+	80-84
74.1-77.1	B	70-79
72.6-74	B-	65-69
71.1-72.5	C+	60-64
65-71	C	41-59
62.7-64.9	C-	34-40
51.7-62.6	D	15-34
0-51.7	F	0-14

（4）能耗管理
系统应设计有效的能耗管理策略，确保传感器和数据传输装置在尽可能低的能耗下运行，延长使用周期。

		
	(a)低功耗模式下测试结果	(b)蓝牙工作时测试结果
图21 不同工作模式下功耗测试结果
在系统启动时，处于低功耗待命状态，等待蓝牙主机的指令。当蓝牙主机发送开启指令时，将系统从低功耗待命状态唤醒，数据采集任务开始执行。当数据采集任务完成其工作后，系统再次进入低功耗待命状态，等待下一次蓝牙指令的到来。
将设备连接至USB功耗测试仪可测定系统在不同状态下的功耗，图21展示了测试结果，结果显示当系统工作在低功耗状态时，系统功耗接近0mW，系统工作时，功耗接近104.2mW，能耗管理策略正常运行，满足设计要求。

2. 定量指标测试（说明测试方法、步骤及结果）
（1）漏尿识别：漏尿监测误报率不应超过5%。
漏尿监测系统的准确性直接影响用户体验和系统可靠性。误报率过高会导致用户不信任系统，而漏报则会漏掉重要的健康信息。选择5%的误报率标准是为了平衡这两方面的需求，同时考虑到技术实现的难度和成本。
根据1h尿垫试验标准与实验结果进行比对计算准确度，使用公式：

其中，TP为真正正确，表示一些正确的样本被判定为正，这就是被称为判断为真的确情况。TN为真正错误，表示一些错误的样本被判定为错误，这就是被称为真的错误情况。FP为假的正确，表示一些错误的样本被判断为真，这就是假的正确情况，被称为误报。FN为假的错误，表示一些正确的样本被判断为错误，这就是假的错误情况，被称为漏报。
在尿失禁频次测试实验中根据GB/T8939-2018规定，尿片的吸水时间不会大于60s，本项目中传感尿片中使用的吸水材料的吸收时间都不超过20s，根据任务书要求，在60s内的再次失禁还是视为仅一次失禁，因此每次滴液时间间隔大于60s，上一次滴下的液体就会被完全吸收，因此大于60s的间隔的滴液效果都相同，本文中采用的时间间隔为2min。
实验步骤如下：尿量和尿频次检测需要先将60mL的针管固定，然后固定传感尿片，再将传感尿片连接到前端模块采样端，然后每隔2min往传感尿片上滴2mL的模拟尿液，共滴10次，若当前传感尿片滴液量达到50mL饱和，则更换传感尿片，否则本组10次实验结束后，更换传感尿片。重复上述步骤，每个档位重复3组实验。实验结束后对比上位机输出结果。实验结果如表2所示
表2中，TP为本次又滴液，上位机判定出漏尿，即正确判定；FP为本次没有滴液，但是上位机判定了漏尿，即误判；FN为本次滴液，上位机并未发出漏尿判定，即漏判。由表可知，整个实验结果平均准确度约为85.92%，平均误报率为4.93%，平均漏报率为6.77%，误报率低于要求的5%，达到预期。

表2 尿失禁频次统计表
挡位	第一组	第二组	第三组
	TP	FP	FN	TP	FP	FN	TP	FP	FN
2mL	10	0	0	10	0	0	10	0	0
4mL	10	0	0	10	0	0	10	0	0
6mL	10	0	0	9	0	1	10	0	0
8mL	10	0	0	9	1	1	9	0	1
10mL	9	0	1	10	1	0	10	0	0
12mL	9	1	1	9	0	1	8	0	2
14mL	9	1	1	9	1	1	9	0	1
16mL	8	1	2	8	2	2	7	2	3
18mL	7	1	3	7	1	3	8	2	2
总计	82	4	8	81	6	9	81	4	9
准确率	87.23%	84.38%	86.17%
误报率	4.65%	6.90%	4.71%
漏报率	8.89%	10%	10%

（2）传感器尺寸与重量：传感器的厚度应不超过2毫米，重量不超过20克，以最小化对用户的影响。
传感器的尺寸和重量直接影响穿戴舒适度。2毫米的厚度和20克的重量限制旨在确保传感器对日常活动的干扰最小化。
使用精密测量仪器（如游标卡尺、千分尺）测量传感器的厚度，如图22所示。测量10次，取平均值确保准确性。

图22 传感器厚度测量示意图

表3 传感器厚度多次测量值
测量次数	1	2	3	4	5
传感器厚度/mm	1.32	1.31	1.33	1.32	1.31
测量次数	6	7	8	9	10
传感器厚度/mm	1.33	1.32	1.34	1.30	1.32
平均值	1.32mm

（3）电池续航：在正常使用条件下，电池续航不少于12小时，以减少充电或更换电池的频率。
电池满电情况下开启系统采集模式，计时直到电量耗尽，续航达到13小时，达到预期。

（4）防水等级：考虑到使用环境，传感器及相关电子设备需满足至少IP67的防水防尘等级。
按照IP67标准，将传感器及相关电子设备完全浸入水中1米深处，保持30分钟。取出设备，检查其工作状态。

（5）工作温度范围：系统应能在10℃至50℃的温度范围内稳定工作，以适应不同环境条件。
设计考虑到设备可能会在各种环境中的人体皮肤表面温度下使用，从冷到热的温度范围保证了设备的适应性和稳定性。
将设备置于可调温箱中，将温度分别设为10℃、25℃、50℃，保持一段时间（如2小时）。在每个温度点测试设备的各项功能，结果均工作正常，达到预期。

（6）功耗：传感器系统的平均功耗应不超过500毫瓦（mW），以延长电池寿命并减少充电频率。
在设计过程中，需要优化电路设计和算法实现，以尽可能降低功耗，并确保满足设定的功耗限制。通过确保系统的平均功耗不超过500毫瓦，可以在不牺牲设备性能和稳定性的前提下，延长电池寿命，减少用户的充电频率，提升使用体验。
图21测试结果显示了系统在正常工作时的功耗，结果显示当系统工作在低功耗状态时，系统功耗接近0mW，系统工作时，功耗接近104.2mW，能耗管理策略正常运行，满足设计要求。
图23显示了在充电过程中功率的大小，约为5W。


图23 电池充电功耗

五、成本核算
名称	数量	决算
STM32F103CBT6	1	￥0.7/个
doBT-M02	1	￥3.8/个
doBT-P01	1	￥9.8/个
3.7V锂电池	1	￥7.4/个
传感尿片制作	1	￥31.11/个
PCB	1	￥4/个
电阻电容等其他元器件	1	￥0.71/个
K-704NB有机硅密封胶	1	￥4.5/个
总计	1	￥62.02

六、总结与展望（说明系统中的不足，并对系统中的不足提出可能的改进方法）
本文设计了一套能监测SUI病人尿失禁的传感系统，系统中设计了尿失禁患病等级判断、无线传输、湿度检测传感器等内容。能够实现对病人失禁事件的准确判断，失禁程度的估计。能帮助病人评估当前失禁严重程度，帮助他们判断是否就医；同时能给SUI科研人员提供一种新的监测思路。本节将对设计的尿失禁监测系统进行总结，对当前研究工作中面临的问题进行分析，并针对这些问题提出解决方案和进一步研究工作展望。
6.1总结
本文首先对课题的研究背景与意义进行了介绍，针对现状中日常生活的家庭监护场景，提出了设计需求，并给出了传感系统的设计方案和具体指标。针对功能需求，本文的研究工作如下：为了监测病人尿失禁状况，首先设计了能检测特殊部位的湿度传感器；根据设计需求和性能指标要求，选择了合适的信号采集芯片并设计了相关外围电路；针对低功耗和数据的可靠性，选择了合适本系统的蓝牙芯片，并设计了其外围电路。
除了硬件和结构，为了实现本传感系统功能，还设计了各个模块的嵌入式软件，包括蓝牙通信协议栈的数据传输服务、湿度数据采集；为满足可视化要求，设计了电脑端和手机端的上位机显示界面；为了满足本系统基本需求，设计了尿失禁频次检测、尿失禁级别评定等相关算法；最后根据设计需求和性能指标要求，对各个功能和指标进行了测试和验证。
6.2展望
本文设计的尿失禁监测系统能够实时监测SUI病人尿失禁的状况，可以满足日常监护中尿失禁粗略定级这一需求，但目前还是存在一些问题可以改进：检测指标偏少，尿液检测作为能反映一个人身体良好状况的重要手段，还有更多的相关指标可以进行监测，比如PH值、蛋白质、葡萄糖、尿酸等。因此后期研究工作可以再添加更多测量尿液成分的传感器来监测病人身体健康状况。
无法同时监测病人漏尿时的姿态，压力性尿失禁的诱因十分复杂，后期以通过添加压力传感器、多加速度传感器等方式来检测病人更多姿态，如咳嗽、大笑等。漏尿时的姿态数据有助于完善压力性尿失禁的诱因分析。
传感尿片在实际上身后会产生形变，影响检测结果的准确性，因此后期可以
考虑研究立体的传感器结构，减少形变影响。或者增加温度或者其他传感器来提高检测结果的准确性。
